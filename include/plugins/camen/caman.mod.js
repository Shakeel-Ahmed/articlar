function selectText(){var t;document.selection?((t=document.body.createTextRange()).moveToElementText(this),t.select()):window.getSelection&&((t=document.createRange()).selectNode(this),window.getSelection().addRange(t))}$(document).ready(function(){$("body").on("click",".CopyCommand",selectText)}),function(){var t=document.createElement("input");try{if((t.type="range")==t.type)return}catch(t){return}if(document.mozSetImageElement&&"MozAppearance"in t.style){var w,D="MacIntel"==navigator.platform,R={radius:D?9:6,width:D?22:12,height:D?16:20},M="-moz-linear-gradient(top, transparent "+(D?"6px, #999 6px, #999 7px, #ccc 9px, #bbb 11px, #bbb 12px, transparent 12px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)",S={"min-width":R.width+"px","min-height":R.height+"px","max-height":R.height+"px",padding:0,border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"},P=document.createEvent("HTMLEvents");P.initEvent("change",!0,!1),"loading"==document.readyState?document.addEventListener("DOMContentLoaded",e,!0):e()}function e(){Array.forEach(document.querySelectorAll("input[type=range]"),r),document.addEventListener("DOMNodeInserted",i,!0)}function i(t){n(t.target),t.target.querySelectorAll&&Array.forEach(t.target.querySelectorAll("input"),n)}function n(t,e){"input"!=t.localName||"range"==t.type||("range"==t.getAttribute("type")?r(t):e||setTimeout(n,0,t,!0))}function r(i){var n,r,s,o,e,a,u,h,c,l,p,d=i.value;w||(I(w=document.body.appendChild(document.createElement("hr")),{"-moz-appearance":D?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"}),document.mozSetImageElement("__sliderthumb__",w));var f=function(){return""+d};function g(t){var e=(parseFloat(getComputedStyle(this,0).width)-R.width)/p;e&&(a+=(t.clientX-u)/e,u=t.clientX,s=!0,this.value=a)}function m(){this.removeEventListener("mousemove",g,!0),this.removeEventListener("mouseup",m,!0)}function y(){o||(this.style.boxShadow=D?"0 0 2px 1px -moz-mac-focusring, inset 0 0 1px -moz-mac-focusring":"0 0 0 2px #fb0")}function v(t){return!isNaN(t)&&+t==parseFloat(t)}function b(){h=v(i.min)?+i.min:0,(c=v(i.max)?+i.max:100)<h&&(c=100<h?h:100),l=v(i.step)&&0<i.step?+i.step:1,p=c-h,x(!0)}function x(t){(n||r||(d=i.getAttribute("value")),v(d)||(d=(h+c)/2),(d=Math.round((d-h)/l)*l+h)<h?d=h:c<d&&(d=h+~~(p/l)*l),s&&d!=e&&i.dispatchEvent(P),s=!1,t||d!=e)&&(e=d,I(i,{background:"-moz-element(#__sliderthumb__) "+(p?(d-h)/p*100:0)+"% no-repeat, "+M}))}i.__defineGetter__("value",f),i.__defineSetter__("value",function t(e){d=""+e,n=!0,x(),delete i.value,i.value=d,i.__defineGetter__("value",f),i.__defineSetter__("value",t)}),i.__defineGetter__("type",function(){return"range"}),["min","max","step"].forEach(function(e){i.hasAttribute(e)&&(r=!0),i.__defineGetter__(e,function(){return this.hasAttribute(e)?this.getAttribute(e):""}),i.__defineSetter__(e,function(t){null===t?this.removeAttribute(e):this.setAttribute(e,t)})}),i.readOnly=!0,I(i,S),b(),i.addEventListener("DOMAttrModified",function(t){"value"!=t.attrName||n?~["min","max","step"].indexOf(t.attrName)&&(b(),r=!0):(d=t.newValue,x())},!0),i.addEventListener("mousedown",function(t){if(o=!0,setTimeout(function(){o=!1},0),t.button||!p)return;var e=(parseFloat(getComputedStyle(this,0).width)-R.width)/p;if(!e)return;var i=t.clientX-this.getBoundingClientRect().left-R.width/2-(d-h)*e;Math.abs(i)>R.radius&&(s=!0,this.value-=-i/e);a=d,u=t.clientX,this.addEventListener("mousemove",g,!0),this.addEventListener("mouseup",m,!0)},!0),i.addEventListener("keydown",function(t){36<t.keyCode&&t.keyCode<41&&(y.call(this),s=!0,this.value=d+(38==t.keyCode||39==t.keyCode?l:-l))},!0),i.addEventListener("focus",y,!0),i.addEventListener("blur",function(){this.style.boxShadow=""},!0)}function I(t,e){for(var i in e)t.style.setProperty(i,e[i],"important")}}(),function(){var t=this,e=t._,o={},r=Array.prototype,i=Object.prototype,n=Function.prototype,s=r.push,a=r.slice,u=r.concat,l=(r.unshift,i.toString),h=i.hasOwnProperty,c=r.forEach,p=r.map,d=r.reduce,f=r.reduceRight,g=r.filter,m=r.every,y=r.some,v=r.indexOf,b=r.lastIndexOf,x=Array.isArray,w=Object.keys,D=n.bind,R=function(t){return t instanceof R?t:this instanceof R?void(this._wrapped=t):new R(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=R),exports._=R):t._=R,R.VERSION="1.4.2";var M=R.each=R.forEach=function(t,e,i){if(null!=t)if(c&&t.forEach===c)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,r=t.length;n<r;n++)if(e.call(i,t[n],n,t)===o)return}else for(var s in t)if(R.has(t,s)&&e.call(i,t[s],s,t)===o)return};R.map=R.collect=function(t,n,r){var s=[];return null==t?s:p&&t.map===p?t.map(n,r):(M(t,function(t,e,i){s[s.length]=n.call(r,t,e,i)}),s)},R.reduce=R.foldl=R.inject=function(t,n,r,s){var o=2<arguments.length;if(null==t&&(t=[]),d&&t.reduce===d)return s&&(n=R.bind(n,s)),o?t.reduce(n,r):t.reduce(n);if(M(t,function(t,e,i){o?r=n.call(s,r,t,e,i):(r=t,o=!0)}),!o)throw new TypeError("Reduce of empty array with no initial value");return r},R.reduceRight=R.foldr=function(n,r,s,o){var a=2<arguments.length;if(null==n&&(n=[]),f&&n.reduceRight===f)return o&&(r=R.bind(r,o)),2<arguments.length?n.reduceRight(r,s):n.reduceRight(r);var u=n.length;if(u!==+u){var h=R.keys(n);u=h.length}if(M(n,function(t,e,i){e=h?h[--u]:--u,a?s=r.call(o,s,n[e],e,i):(s=n[e],a=!0)}),!a)throw new TypeError("Reduce of empty array with no initial value");return s},R.find=R.detect=function(t,n,r){var s;return S(t,function(t,e,i){if(n.call(r,t,e,i))return s=t,!0}),s},R.filter=R.select=function(t,n,r){var s=[];return null==t?s:g&&t.filter===g?t.filter(n,r):(M(t,function(t,e,i){n.call(r,t,e,i)&&(s[s.length]=t)}),s)},R.reject=function(t,n,r){var s=[];return null==t||M(t,function(t,e,i){n.call(r,t,e,i)||(s[s.length]=t)}),s},R.every=R.all=function(t,n,r){n||(n=R.identity);var s=!0;return null==t?s:m&&t.every===m?t.every(n,r):(M(t,function(t,e,i){if(!(s=s&&n.call(r,t,e,i)))return o}),!!s)};var S=R.some=R.any=function(t,n,r){n||(n=R.identity);var s=!1;return null==t?s:y&&t.some===y?t.some(n,r):(M(t,function(t,e,i){if(s||(s=n.call(r,t,e,i)))return o}),!!s)};R.contains=R.include=function(t,e){var i=!1;return null==t?i:v&&t.indexOf===v?-1!=t.indexOf(e):i=S(t,function(t){return t===e})},R.invoke=function(t,e){var i=a.call(arguments,2);return R.map(t,function(t){return(R.isFunction(e)?e:t[e]).apply(t,i)})},R.pluck=function(t,e){return R.map(t,function(t){return t[e]})},R.where=function(t,i){return R.isEmpty(i)?[]:R.filter(t,function(t){for(var e in i)if(i[e]!==t[e])return!1;return!0})},R.max=function(t,r,s){if(!r&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!r&&R.isEmpty(t))return-1/0;var o={computed:-1/0};return M(t,function(t,e,i){var n=r?r.call(s,t,e,i):t;n>=o.computed&&(o={value:t,computed:n})}),o.value},R.min=function(t,r,s){if(!r&&R.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!r&&R.isEmpty(t))return 1/0;var o={computed:1/0};return M(t,function(t,e,i){var n=r?r.call(s,t,e,i):t;n<o.computed&&(o={value:t,computed:n})}),o.value},R.shuffle=function(t){var e,i=0,n=[];return M(t,function(t){e=R.random(i++),n[i-1]=n[e],n[e]=t}),n};var P=function(e){return R.isFunction(e)?e:function(t){return t[e]}};R.sortBy=function(t,e,n){var r=P(e);return R.pluck(R.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var I=function(n,t,r,s){var o={},a=P(t);return M(n,function(t,e){var i=a.call(r,t,e,n);s(o,i,t)}),o};R.groupBy=function(t,e,i){return I(t,e,i,function(t,e,i){(R.has(t,e)?t[e]:t[e]=[]).push(i)})},R.countBy=function(t,e,i){return I(t,e,i,function(t,e,i){R.has(t,e)||(t[e]=0),t[e]++})},R.sortedIndex=function(t,e,i,n){for(var r=(i=null==i?R.identity:P(i)).call(n,e),s=0,o=t.length;s<o;){var a=s+o>>>1;i.call(n,t[a])<r?s=a+1:o=a}return s},R.toArray=function(t){return t?t.length===+t.length?a.call(t):R.values(t):[]},R.size=function(t){return t.length===+t.length?t.length:R.keys(t).length},R.first=R.head=R.take=function(t,e,i){return null==e||i?t[0]:a.call(t,0,e)},R.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},R.last=function(t,e,i){return null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},R.rest=R.tail=R.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},R.compact=function(t){return R.filter(t,function(t){return!!t})};var C=function(t,e,i){return M(t,function(t){R.isArray(t)?e?s.apply(i,t):C(t,e,i):i.push(t)}),i};R.flatten=function(t,e){return C(t,e,[])},R.without=function(t){return R.difference(t,a.call(arguments,1))},R.uniq=R.unique=function(i,n,t,e){var r=t?R.map(i,t,e):i,s=[],o=[];return M(r,function(t,e){(n?e&&o[o.length-1]===t:R.contains(o,t))||(o.push(t),s.push(i[e]))}),s},R.union=function(){return R.uniq(u.apply(r,arguments))},R.intersection=function(t){var i=a.call(arguments,1);return R.filter(R.uniq(t),function(e){return R.every(i,function(t){return 0<=R.indexOf(t,e)})})},R.difference=function(t){var e=u.apply(r,a.call(arguments,1));return R.filter(t,function(t){return!R.contains(e,t)})},R.zip=function(){for(var t=a.call(arguments),e=R.max(R.pluck(t,"length")),i=new Array(e),n=0;n<e;n++)i[n]=R.pluck(t,""+n);return i},R.object=function(t,e){for(var i={},n=0,r=t.length;n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},R.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return t[n=R.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,r+i):i}if(v&&t.indexOf===v)return t.indexOf(e,i);for(;n<r;n++)if(t[n]===e)return n;return-1},R.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(b&&t.lastIndexOf===b)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},R.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);r<n;)s[r++]=t,t+=i;return s};var F=function(){};R.bind=function(i,n){var r,s;if(i.bind===D&&D)return D.apply(i,a.call(arguments,1));if(!R.isFunction(i))throw new TypeError;return s=a.call(arguments,2),r=function(){if(!(this instanceof r))return i.apply(n,s.concat(a.call(arguments)));F.prototype=i.prototype;var t=new F,e=i.apply(t,s.concat(a.call(arguments)));return Object(e)===e?e:t}},R.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=R.functions(e)),M(t,function(t){e[t]=R.bind(e[t],e)}),e},R.memoize=function(e,i){var n={};return i||(i=R.identity),function(){var t=i.apply(this,arguments);return R.has(n,t)?n[t]:n[t]=e.apply(this,arguments)}},R.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},R.defer=function(t){return R.delay.apply(R,[t,1].concat(a.call(arguments,1)))},R.throttle=function(t,e){var i,n,r,s,o,a,u=R.debounce(function(){o=s=!1},e);return function(){i=this,n=arguments;return r||(r=setTimeout(function(){r=null,o&&(a=t.apply(i,n)),u()},e)),s?o=!0:(s=!0,a=t.apply(i,n)),u(),a}},R.debounce=function(n,r,s){var o,a;return function(){var t=this,e=arguments,i=s&&!o;return clearTimeout(o),o=setTimeout(function(){o=null,s||(a=n.apply(t,e))},r),i&&(a=n.apply(t,e)),a}},R.once=function(t){var e,i=!1;return function(){return i||(i=!0,e=t.apply(this,arguments),t=null),e}},R.wrap=function(e,i){return function(){var t=[e];return s.apply(t,arguments),i.apply(this,t)}},R.compose=function(){var i=arguments;return function(){for(var t=arguments,e=i.length-1;0<=e;e--)t=[i[e].apply(this,t)];return t[0]}},R.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},R.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)R.has(t,i)&&(e[e.length]=i);return e},R.values=function(t){var e=[];for(var i in t)R.has(t,i)&&e.push(t[i]);return e},R.pairs=function(t){var e=[];for(var i in t)R.has(t,i)&&e.push([i,t[i]]);return e},R.invert=function(t){var e={};for(var i in t)R.has(t,i)&&(e[t[i]]=i);return e},R.functions=R.methods=function(t){var e=[];for(var i in t)R.isFunction(t[i])&&e.push(i);return e.sort()},R.extend=function(i){return M(a.call(arguments,1),function(t){for(var e in t)i[e]=t[e]}),i},R.pick=function(e){var i={},t=u.apply(r,a.call(arguments,1));return M(t,function(t){t in e&&(i[t]=e[t])}),i},R.omit=function(t){var e={},i=u.apply(r,a.call(arguments,1));for(var n in t)R.contains(i,n)||(e[n]=t[n]);return e},R.defaults=function(i){return M(a.call(arguments,1),function(t){for(var e in t)null==i[e]&&(i[e]=t[e])}),i},R.clone=function(t){return R.isObject(t)?R.isArray(t)?t.slice():R.extend({},t):t},R.tap=function(t,e){return e(t),t};var L=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof R&&(t=t._wrapped),e instanceof R&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;i.push(t),n.push(e);var o=0,a=!0;if("[object Array]"==r){if(a=(o=t.length)==e.length)for(;o--&&(a=L(t[o],e[o],i,n)););}else{var u=t.constructor,h=e.constructor;if(u!==h&&!(R.isFunction(u)&&u instanceof u&&R.isFunction(h)&&h instanceof h))return!1;for(var c in t)if(R.has(t,c)&&(o++,!(a=R.has(e,c)&&L(t[c],e[c],i,n))))break;if(a){for(c in e)if(R.has(e,c)&&!o--)break;a=!o}}return i.pop(),n.pop(),a};R.isEqual=function(t,e){return L(t,e,[],[])},R.isEmpty=function(t){if(null==t)return!0;if(R.isArray(t)||R.isString(t))return 0===t.length;for(var e in t)if(R.has(t,e))return!1;return!0},R.isElement=function(t){return!(!t||1!==t.nodeType)},R.isArray=x||function(t){return"[object Array]"==l.call(t)},R.isObject=function(t){return t===Object(t)},M(["Arguments","Function","String","Number","Date","RegExp"],function(e){R["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),R.isArguments(arguments)||(R.isArguments=function(t){return!(!t||!R.has(t,"callee"))}),"function"!=typeof/./&&(R.isFunction=function(t){return"function"==typeof t}),R.isFinite=function(t){return R.isNumber(t)&&isFinite(t)},R.isNaN=function(t){return R.isNumber(t)&&t!=+t},R.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==l.call(t)},R.isNull=function(t){return null===t},R.isUndefined=function(t){return void 0===t},R.has=function(t,e){return h.call(t,e)},R.noConflict=function(){return t._=e,this},R.identity=function(t){return t},R.times=function(t,e,i){for(var n=0;n<t;n++)e.call(i,n)},R.random=function(t,e){return null==e&&(e=t,t=0),t+(0|Math.random()*(e-t+1))};var k={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};k.unescape=R.invert(k.escape);var B={escape:new RegExp("["+R.keys(k.escape).join("")+"]","g"),unescape:new RegExp("("+R.keys(k.unescape).join("|")+")","g")};R.each(["escape","unescape"],function(e){R[e]=function(t){return null==t?"":(""+t).replace(B[e],function(t){return k[e][t]})}}),R.result=function(t,e){if(null==t)return null;var i=t[e];return R.isFunction(i)?i.call(t):i},R.mixin=function(i){M(R.functions(i),function(t){var e=R[t]=i[t];R.prototype[t]=function(){var t=[this._wrapped];return s.apply(t,arguments),T.call(this,e.apply(R,t))}})};var _=0;R.uniqueId=function(t){var e=_++;return t?t+e:e},R.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},E=/\\|'|\r|\n|\t|\u2028|\u2029/g;R.template=function(s,t,e){e=R.defaults({},e,R.templateSettings);var i=new RegExp([(e.escape||A).source,(e.interpolate||A).source,(e.evaluate||A).source].join("|")+"|$","g"),o=0,a="__p+='";s.replace(i,function(t,e,i,n,r){a+=s.slice(o,r).replace(E,function(t){return"\\"+z[t]}),a+=e?"'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":i?"'+\n((__t=("+i+"))==null?'':__t)+\n'":n?"';\n"+n+"\n__p+='":"",o=r+t.length}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var n=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}if(t)return n(t,R);var r=function(t){return n.call(this,t,R)};return r.source="function("+(e.variable||"obj")+"){\n"+a+"}",r},R.chain=function(t){return R(t).chain()};var T=function(t){return this._chain?R(t).chain():t};R.mixin(R),M(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var i=r[e];R.prototype[e]=function(){var t=this._wrapped;return i.apply(t,arguments),"shift"!=e&&"splice"!=e||0!==t.length||delete t[0],T.call(this,t)}}),M(["concat","join","slice"],function(t){var e=r[t];R.prototype[t]=function(){return T.call(this,e.apply(this._wrapped,arguments))}}),R.extend(R.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var e,r,h,p,x,s,f,u,o,w,a,c,i,n,D,l,R,t,d,g,m,M,y,v,b,at,S,P,ut,ht,$,W,U,I=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},C=[].slice,F={}.hasOwnProperty;v=["extended","included"],l=function(){function t(){}return t.extends=function(t){var e,i,n;for(e in t)i=t[e],I.call(v,e)<0&&(this[e]=i);return null!=(n=t.extended)&&n.apply(this),this},t.includes=function(t){var e,i,n;for(e in t)i=t[e],I.call(v,e)<0&&(this.prototype[e]=i);return null!=(n=t.included)&&n.apply(this),this},t.delegate=function(){var t,e,i,n,r,s;for(i=(t=1<=arguments.length?C.call(arguments,0):[]).pop(),s=[],n=0,r=t.length;n<r;n++)e=t[n],s.push(this.prototype[e]=i.prototype[e]);return s},t.aliasFunction=function(t,e){var i=this;return this.prototype[t]=function(){var t;return t=1<=arguments.length?C.call(arguments,0):[],i.prototype[e].apply(i,t)}},t.aliasProperty=function(t,e){return Object.defineProperty(this.prototype,t,{get:function(){return this[e]},set:function(t){return this[e]=t}})},t.included=function(t){return t.call(this,this.prototype)},t}(),Array.prototype.slice,e=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},M=function(){function t(){}var e;return t.uniqid=(e=0,{get:function(){return e++}}),t.extend=function(){var t,e,i,n,r,s;for(e=arguments[0],r=0,s=(n=2<=arguments.length?C.call(arguments,1):[]).length;r<s;r++)for(i in t=n[r])F.call(t,i)&&(e[i]=t[i]);return e},t.clampRGB=function(t){switch(t>>8){case 0:return t;case-1:return 0;case 1:return 255}},t.copyAttributes=function(t,e,i){var n,r,s,o,a,u;for(null==i&&(i={}),u=[],r=0,s=(o=t.attributes).length;r<s;r++)n=o[r],null!=i.except&&(a=n.nodeName,0<=I.call(i.except,a))||u.push(e.setAttribute(n.nodeName,n.nodeValue));return u},t.dataArray=function(t){return null==t&&(t=0),x.NodeJS||null!=window.Uint8Array?new Uint8Array(t):new Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(g=exports,f=require("canvas"),i=f.Image,w=require("fibers"),y=require("fs")):g=window,x=function(t){function w(){var t,e,i,n=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof w?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],w.NodeJS||(i=parseInt(w.getAttrId(t[0]),10),e="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(i)||!m.has(i))?(this.id=M.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new r(this),this.renderer=new d(this),this.domIsLoaded(function(){return n.parseArguments(t),n.setup()}),this):m.execute(i,e)):new w(arguments)}return function(t,e){for(var i in e)F.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(w,l),w.version={release:"4.1.1",date:"4/8/2013"},w.DEBUG=!1,w.allowRevert=!0,w.crossOrigin="anonymous",w.remoteProxy="",w.proxyParam="camanProxyUrl",w.NodeJS="undefined"!=typeof exports&&null!==exports,w.autoload=!w.NodeJS,w.toString=function(){return"Version "+w.version.release+", Released "+w.version.date},w.getAttrId=function(t){return!!w.NodeJS||("string"==typeof t&&(t=e(t)),null==t||null==t.getAttribute?null:t.getAttribute("data-caman-id"))},w.prototype.domIsLoaded=function(t){var e,i=this;return w.NodeJS?setTimeout(function(){return t.call(i)},0):"complete"===document.readyState?(D.debug("DOM initialized"),setTimeout(function(){return t.call(i)},0)):(e=function(){if("complete"===document.readyState)return D.debug("DOM initialized"),t.call(i)},document.addEventListener("readystatechange",e,!1))},w.prototype.parseArguments=function(t){var e,i,n,r;if(0===t.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){for(e in r=[],n=t[4])F.call(n,e)&&(i=n[e],r.push(this.options[e]=i));return r}}},w.prototype.setInitObject=function(t){if(w.NodeJS)return this.initObj=t,void(this.initType="node");if(this.initObj="object"==typeof t?t:e(t),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},w.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},w.prototype.initNode=function(){var t=this;return D.debug("Initializing for NodeJS"),this.image=new i,this.image.onload=function(){return D.debug("Image loaded. Width = "+t.imageWidth()+", Height = "+t.imageHeight()),t.canvas=new f(t.imageWidth(),t.imageHeight()),t.finishInit()},this.image.onerror=function(t){throw t},this.image.src=this.initObj},w.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),M.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},w.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},w.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(D.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),c.isRemote(this.image))return this.image.src=c.proxyUrl(this.image.src),D.debug("Remote image detected, using URL = "+this.image.src)},w.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},w.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},w.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},w.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},w.prototype.imageLoaded=function(){return D.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},w.prototype.finishInit=function(){var t,e,i,n,r;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,w.allowRevert)for(this.initializedPixelData=M.dataArray(this.pixelData.length),this.originalPixelData=M.dataArray(this.pixelData.length),t=i=0,n=(r=this.pixelData).length;i<n;t=++i)e=r[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},m.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},w.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},w.prototype.resetOriginalPixelData=function(){var t,e,i,n,r,s;if(!w.allowRevert)throw"Revert disabled";for(this.originalPixelData=M.dataArray(this.pixelData.length),s=[],t=i=0,n=(r=this.pixelData).length;i<n;t=++i)e=r[t],s.push(this.originalPixelData[t]=e);return s},w.prototype.hasId=function(){return null!=w.getAttrId(this.canvas)},w.prototype.assignId=function(){if(!w.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},w.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},w.prototype.hiDPIAdjustments=function(){var t;if(!w.NodeJS&&this.needsHiDPISwap())return 1!==(t=this.hiDPIRatio())?(D.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},w.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},w.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},w.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},w.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},w.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),w.NodeJS||e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},w.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),o.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},w.prototype.revert=function(t){var e,i,n,r,s;if(null==t&&(t=!0),!w.allowRevert)throw"Revert disabled";for(e=n=0,r=(s=this.originalVisiblePixels()).length;n<r;e=++n)i=s[e],this.pixelData[e]=i;if(t)return this.context.putImageData(this.imageData,0,0)},w.prototype.reset=function(){var t,e,i,n,r,s,o,a,u;for(t=document.createElement("canvas"),M.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,s=(n=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,i=o=0,a=(u=this.initializedPixelData).length;o<a;i=++o)r=u[i],s[i]=r;return e.putImageData(n,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},w.prototype.originalVisiblePixels=function(){var t,e,i,n,r,s,o,a,u,h,c,l,p,d,f,g,m,y,v,b,x;if(!w.allowRevert)throw"Revert disabled";if(h=[],n=(l=this.cropCoordinates.x)+this.width,r=(p=this.cropCoordinates.y)+this.height,this.resized){for((t=document.createElement("canvas")).width=this.originalWidth,t.height=this.originalHeight,u=(o=(i=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,s=f=0,m=(y=this.originalPixelData).length;f<m;s=++f)a=y[s],u[s]=a;i.putImageData(o,0,0),(c=document.createElement("canvas")).width=this.width,c.height=this.height,(i=c.getContext("2d")).drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),u=i.getImageData(0,0,this.width,this.height).data,d=this.width}else u=this.originalPixelData,d=this.originalWidth;for(s=g=0,v=u.length;g<v;s=g+=4)l<=(b=(e=R.locationToCoordinates(s,d)).x)&&b<n&&p<=(x=e.y)&&x<r&&h.push(u[s],u[s+1],u[s+2],u[s+3]);return h},w.prototype.process=function(t,e){return this.renderer.add({type:a.Type.Single,name:t,processFn:e}),this},w.prototype.processKernel=function(t,e,i,n){var r,s,o;if(null==i&&(i=null),null==n&&(n=0),null==i)for(r=s=i=0,o=e.length;0<=o?s<o:o<s;r=0<=o?++s:--s)i+=e[r];return this.renderer.add({type:a.Type.Kernel,name:t,adjust:e,divisor:i,bias:n}),this},w.prototype.processPlugin=function(t,e){return this.renderer.add({type:a.Type.Plugin,plugin:t,args:e}),this},w.prototype.newLayer=function(t){var e;return e=new n(this),this.canvasQueue.push(e),this.renderer.add({type:a.Type.LayerDequeue}),t.call(e),this.renderer.add({type:a.Type.LayerFinished}),this},w.prototype.executeLayer=function(t){return this.pushContext(t)},w.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},w.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},w.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},w}(),(g.Caman=x).Analyze=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,i,n,r,s,o;for(e={r:{},g:{},b:{}},t=n=0;n<=255;t=++n)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=r=0,o=this.c.pixelData.length;r<o;t=r+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(i=this.c.pixelData.length/4,t=s=0;s<=255;t=++s)e.r[t]/=i,e.g[t]/=i,e.b[t]/=i;return e},t}(),r=x.Analyze,x.DOMUpdated=function(){var t,e,i,n,r;if(0<(e=document.querySelectorAll("img[data-caman]")).length){for(r=[],i=0,n=e.length;i<n;i++)t=e[i],r.push(new s(t,function(){return this.parse(),this.execute()}));return r}},x.autoload&&("complete"===document.readyState?x.DOMUpdated():document.addEventListener("DOMContentLoaded",x.DOMUpdated,!1)),s=function(){var l;function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=x(t,e.bind(this))}return l="(\\w+)\\((.*?)\\)",t.prototype.parse=function(){var t,e,i,n,r,s,o,a,u,h,c;if(this.ele=this.caman.canvas,s=new RegExp(l,"g"),0<(o=this.dataStr.match(s)).length){for(s=new RegExp(l),c=[],a=0,u=o.length;a<u;a++){(h=o[a].match(s))[0],i=h[1],t=h[2],r=new Function("return function() {        this."+i+"("+t+");      };");try{n=r(),c.push(n.call(this.caman))}catch(t){e=t,c.push(D.debug(e))}}return c}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),x.Blender=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,i){return this.blenders[t](e,i)},t}(),h=x.Blender,x.Calculate=function(){function t(){}return t.distance=function(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))},t.randomRange=function(t,e,i){var n;return null==i&&(i=!1),n=t+Math.random()*(e-t),i?n.toFixed(i):Math.round(n)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,i,n,r,s){var o,a,u,h,c,l,p,d,f,g,m,y,v,b,x,w,D,R,M,S,P,I,C,F,L,k,B;for(x=t[0],M=t[1],w=e[0],S=e[1],D=i[0],P=i[1],R=n[0],I=n[1],p={},o=R-x-(c=parseInt(3*(w-x),10))-(u=3*(D-w)-c),a=I-M-(l=3*(S-M))-(h=3*(P-S)-l),g=C=0;C<1e3;g=++C)b=g/1e3,d=Math.round(o*Math.pow(b,3)+u*Math.pow(b,2)+c*b+x),f=Math.round(a*Math.pow(b,3)+h*Math.pow(b,2)+l*b+M),r&&f<r?f=r:s&&s<f&&(f=s),p[d]=f;if(p.length<n[0]+1)for(g=F=0,k=n[0];0<=k?F<=k:k<=F;g=0<=k?++F:--F)if(null==p[g]){for(y=[g-1,p[g-1]],m=L=g,B=n[0];g<=B?L<=B:B<=L;m=g<=B?++L:--L)if(null!=p[m]){v=[m,p[m]];break}p[g]=y[1]+(v[1]-y[1])/(v[0]-y[0])*(g-y[0])}return null==p[n[0]]&&(p[n[0]]=p[n[0]-1]),p},t}(),p=x.Calculate,x.Convert=function(){function t(){}return t.hexToRGB=function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}},t.rgbToHSL=function(t,e,i){var n,r,s,o,a,u;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),t/=255,e/=255,i/=255,o=Math.max(t,e,i),a=Math.min(t,e,i),s=(o+a)/2,o===a?r=u=0:(n=o-a,u=.5<s?n/(2-o-a):n/(o+a),r=function(){switch(o){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:u,l:s}},t.hslToRGB=function(t,e,i){var n,r,s,o,a;return"object"==typeof t&&(e=t.s,i=t.l,t=t.h),0===e?a=r=n=i:(s=2*i-(o=i<.5?i*(1+e):i+e-i*e),a=this.hueToRGB(s,o,t+1/3),r=this.hueToRGB(s,o,t),n=this.hueToRGB(s,o,t-1/3)),{r:255*a,g:255*r,b:255*n}},t.hueToRGB=function(t,e,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},t.rgbToHSV=function(t,e,i){var n,r,s,o,a,u;return t/=255,e/=255,i/=255,s=Math.max(t,e,i),o=Math.min(t,e,i),n=(u=s)-o,a=0===s?0:n/s,s===o?r=0:(r=function(){switch(s){case t:return(e-i)/n+(e<i?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:a,v:u}},t.hsvToRGB=function(t,e,i){var n,r,s,o,a,u,h,c;switch(a=i*(1-e),u=i*(1-(r=6*t-(o=Math.floor(6*t)))*e),c=i*(1-(1-r)*e),o%6){case 0:h=i,s=c,n=a;break;case 1:h=u,s=i,n=a;break;case 2:h=a,s=i,n=c;break;case 3:h=a,s=u,n=i;break;case 4:h=c,s=a,n=i;break;case 5:h=i,s=a,n=u}return{r:Math.floor(255*h),g:Math.floor(255*s),b:Math.floor(255*n)}},t.rgbToXYZ=function(t,e,i){return e/=255,i/=255,.04045<(t/=255)?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,.04045<e?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,.04045<i?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:100*(.4124*t+.3576*e+.1805*i),y:100*(.2126*t+.7152*e+.0722*i),z:100*(.0193*t+.1192*e+.9505*i)}},t.xyzToRGB=function(t,e,i){var n,r,s;return r=-.9689*(t/=100)+1.8758*(e/=100)+.0415*(i/=100),n=.0557*t+-.204*e+1.057*i,.0031308<(s=3.2406*t+-1.5372*e+-.4986*i)?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,.0031308<r?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,.0031308<n?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,{r:255*s,g:255*r,b:255*n}},t.xyzToLab=function(t,e,i){return"object"==typeof t&&(e=t.y,i=t.z,t=t.x),e/=100,i/=108.883,t=.008856451679<(t/=95.047)?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=.008856451679<e?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(i=.008856451679<i?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}},t.labToXYZ=function(t,e,i){var n,r,s;return"object"==typeof t&&(e=t.a,i=t.b,t=t.l),s=(r=(t+16)/116)-i/200,.2068965517<(n=r+e/500)?n*=n*n:n=.1284185493*(n-.1379310345),.2068965517<r?r*=r*r:r=.1284185493*(r-.1379310345),.2068965517<s?s*=s*s:s=.1284185493*(s-.1379310345),{x:95.047*n,y:100*r,z:108.883*s}},t.rgbToLab=function(t,e,i){var n;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),n=this.rgbToXYZ(t,e,i),this.xyzToLab(n)},t.labToRGB=function(t,e,i){},t}(),u=x.Convert,x.Event=function(){function t(){}return t.events={},t.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],t.trigger=function(t,e,i){var n,r,s,o,a;if(null==i&&(i=null),this.events[e]&&this.events[e].length){for(a=[],r=0,s=(o=this.events[e]).length;r<s;r++)null===(n=o[r]).target||t.id===n.target.id?a.push(n.fn.call(t,i)):a.push(void 0);return a}},t.listen=function(t,e,i){var n,r;return"string"==typeof t&&(r=t,n=e,t=null,e=r,i=n),!(I.call(this.types,e)<0)&&(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:i}),!0)},t}(),o=x.Event,x.Filter=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return x.prototype[t]=e},t}(),a=x.Filter,x.IO=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null!=t&&(!this.corsEnabled(t)&&this.isURLRemote(t.src))},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){var e;return!!(e=t.match(this.domainRegex))&&e[1]!==document.domain},t.remoteCheck=function(t){if(this.isURLRemote(t)){if(x.remoteProxy.length)return x.isURLRemote(x.remoteProxy)?void D.info("Cannot use a remote proxy for loading images."):this.proxyUrl(t);D.info("Attempting to load a remote image without a configured proxy. URL: "+t)}},t.proxyUrl=function(t){return x.remoteProxy+"?"+x.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return null!=(e={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[t=t.toLowerCase()]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),x.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},x.prototype.browserSave=function(t){var e;return null==t&&(t="png"),t=t.toLowerCase(),e=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=e},x.prototype.nodeSave=function(e,t){null==t&&(t=!0);try{if(y.statSync(e).isFile()&&!t)return!1}catch(t){t,D.debug("Creating output file "+e)}return y.writeFile(e,this.canvas.toBuffer(),function(){return D.debug("Finished writing to "+e)})},x.prototype.toImage=function(t){var e;return(e=document.createElement("img")).src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},x.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},c=x.IO,x.Layer=function(){function t(t){this.c=t,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=M.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new f:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return t.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},t.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},t.prototype.opacity=function(t){return this.options.opacity=t/100,this},t.prototype.copyParent=function(){var t,e,i,n;for(e=this.c.pixelData,t=i=0,n=this.c.pixelData.length;i<n;t=i+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},t.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},t.prototype.overlayImage=function(t){return"object"==typeof t?t=t.src:"string"==typeof t&&"#"===t[0]&&(t=e(t).src),t&&this.c.renderer.renderQueue.push({type:a.Type.LoadOverlay,src:t,layer:this}),this},t.prototype.applyToParent=function(){var t,e,i,n,r,s,o,a,u;for(i=this.c.pixelStack[this.c.pixelStack.length-1],u=[],t=o=0,a=(e=this.c.pixelData).length;o<a;t=o+=4)s={r:i[t],g:i[t+1],b:i[t+2],a:i[t+3]},r={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},(n=h.execute(this.options.blendingMode,r,s)).r=M.clampRGB(n.r),n.g=M.clampRGB(n.g),n.b=M.clampRGB(n.b),null==n.a&&(n.a=r.a),i[t]=s.r-(s.r-n.r)*(this.options.opacity*(n.a/255)),i[t+1]=s.g-(s.g-n.g)*(this.options.opacity*(n.a/255)),u.push(i[t+2]=s.b-(s.b-n.b)*(this.options.opacity*(n.a/255)));return u},t}(),n=x.Layer,x.Logger=function(){var t,e,i,n;for(e=0,i=(n=["log","info","warn","error"]).length;e<i;e++)this[t=n[e]]=function(i){return function(){var e;if(e=1<=arguments.length?C.call(arguments,0):[],x.DEBUG)try{return console[i].apply(console,e)}catch(t){return console[i](e)}}}(t);this.debug=this.log},D=new x.Logger,x.Pixel=function(){function n(t,e,i,n,r){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=i?i:0,this.a=null!=n?n:255,this.c=null!=r?r:null,this.loc=0}return n.coordinatesToLocation=function(t,e,i){return 4*(e*i+t)},n.locationToCoordinates=function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}},n.prototype.setContext=function(t){return this.c=t},n.prototype.locationXY=function(){var t;if(null==this.c)throw"Requires a CamanJS context";return t=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),{x:this.loc%(4*this.c.dimensions.width)/4,y:t}},n.prototype.pixelAtLocation=function(t){if(null==this.c)throw"Requires a CamanJS context";return new n(this.c.pixelData[t],this.c.pixelData[t+1],this.c.pixelData[t+2],this.c.pixelData[t+3],this.c)},n.prototype.getPixelRelative=function(t,e){var i;if(null==this.c)throw"Requires a CamanJS context";return(i=this.loc+4*this.c.dimensions.width*(-1*e)+4*t)>this.c.pixelData.length||i<0?new n(0,0,0,255,this.c):this.pixelAtLocation(i)},n.prototype.putPixelRelative=function(t,e,i){if(null==this.c)throw"Requires a CamanJS context";if(this.loc+4*this.c.dimensions.width*(-1*e)+4*t,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=i.r,this.c.pixelData[newLoc+1]=i.g,this.c.pixelData[newLoc+2]=i.b,this.c.pixelData[newLoc+3]=i.a,!0},n.prototype.getPixel=function(t,e){var i;if(null==this.c)throw"Requires a CamanJS context";return i=this.coordinatesToLocation(t,e,this.width),this.pixelAtLocation(i)},n.prototype.putPixel=function(t,e,i){var n;if(null==this.c)throw"Requires a CamanJS context";return n=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[n]=i.r,this.c.pixelData[n+1]=i.g,this.c.pixelData[n+2]=i.b,this.c.pixelData[n+3]=i.a},n.prototype.toString=function(){return this.toKey()},n.prototype.toHex=function(t){var e;return null==t&&(t=!1),e="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),t?e+this.a.toString(16):e},n}(),R=x.Pixel,x.Plugin=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,i){return this.plugins[e].apply(t,i)},t}(),t=x.Plugin,x.Renderer=function(){function p(t){var e,i;this.c=t,this.processNext=(e=this.processNext,i=this,function(){return e.apply(i,arguments)}),this.renderQueue=[],this.modPixelData=null}return p.Blocks=x.NodeJS?require("os").cpus().length:4,p.prototype.add=function(t){if(null!=t)return this.renderQueue.push(t)},p.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return o.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case a.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case a.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case a.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case a.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},p.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=M.dataArray(this.c.pixelData.length),this.processNext()},p.prototype.eachBlock=function(n){var t,e,i,r,s,o,a,u,h,c,l=this;for(this.blocksDone=0,o=this.c.pixelData.length,s=(t=4*Math.floor(o/4/p.Blocks))+o/4%p.Blocks*4,c=[],r=u=0,h=p.Blocks;0<=h?u<h:h<u;r=0<=h?++u:--u)i=(a=r*t)+(r===p.Blocks-1?s:t),x.NodeJS?(e=w(function(){return n.call(l,r,a,i)}).run(),c.push(this.blockFinished(e))):c.push(setTimeout(function(t,e,i){return function(){return n.call(l,t,e,i)}}(r,a,i),0));return c},p.prototype.executeFilter=function(){return o.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===a.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},p.prototype.executePlugin=function(){return D.debug("Executing plugin "+this.currentJob.plugin),t.execute(this.c,this.currentJob.plugin,this.currentJob.args),D.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},p.prototype.renderBlock=function(t,e,i){var n,r,s;for(D.debug("Block #"+t+" - Filter: "+this.currentJob.name+", Start: "+e+", End: "+i),o.trigger(this.c,"blockStarted",{blockNum:t,totalBlocks:p.Blocks,startPixel:e,endPixel:i}),(r=new R).setContext(this.c),n=s=e;s<i;n=s+=4)r.loc=n,r.r=this.c.pixelData[n],r.g=this.c.pixelData[n+1],r.b=this.c.pixelData[n+2],r.a=this.c.pixelData[n+3],this.currentJob.processFn(r),this.c.pixelData[n]=M.clampRGB(r.r),this.c.pixelData[n+1]=M.clampRGB(r.g),this.c.pixelData[n+2]=M.clampRGB(r.b),this.c.pixelData[n+3]=M.clampRGB(r.a);return x.NodeJS?w.yield(t):this.blockFinished(t)},p.prototype.renderKernel=function(t,e,i){var n,r,s,o,a,u,h,c,l,p,d,f,g,m,y,v,b;for(this.currentJob.name,s=this.currentJob.bias,u=this.currentJob.divisor,d=this.c.pixelData.length,n=this.currentJob.adjust,r=Math.sqrt(n.length),p=[],D.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((r-1)/2)),i=Math.min(i,d-4*this.c.dimensions.width*((r-1)/2)),o=(r-1)/2,(g=new R).setContext(this.c),h=y=e;y<i;h=y+=4){for(g.loc=h,a=0,c=v=-o;-o<=o?v<=o:o<=v;c=-o<=o?++v:--v)for(l=b=o;o<=-o?b<=-o:-o<=b;l=o<=-o?++b:--b)f=g.getPixelRelative(c,l),p[3*a]=f.r,p[3*a+1]=f.g,p[3*a+2]=f.b,a++;m=this.processKernel(n,p,u,s),this.modPixelData[h]=M.clampRGB(m.r),this.modPixelData[h+1]=M.clampRGB(m.g),this.modPixelData[h+2]=M.clampRGB(m.b),this.modPixelData[h+3]=this.c.pixelData[h+3]}return x.NodeJS?w.yield(t):this.blockFinished(t)},p.prototype.blockFinished=function(t){var e,i,n;if(0<=t&&D.debug("Block #"+t+" finished! Filter: "+this.currentJob.name),this.blocksDone++,o.trigger(this.c,"blockFinished",{blockNum:t,blocksFinished:this.blocksDone,totalBlocks:p.Blocks}),this.blocksDone===p.Blocks){if(this.currentJob.type===a.Type.Kernel)for(e=i=0,n=this.c.pixelData.length;0<=n?i<n:n<i;e=0<=n?++i:--i)this.c.pixelData[e]=this.modPixelData[e];return 0<=t&&D.debug("Filter "+this.currentJob.name+" finished!"),o.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},p.prototype.processKernel=function(t,e,i,n){var r,s,o,a;for(s={r:0,g:0,b:0},r=o=0,a=t.length;0<=a?o<a:a<o;r=0<=a?++o:--o)s.r+=t[r]*e[3*r],s.g+=t[r]*e[3*r+1],s.b+=t[r]*e[3*r+2];return s.r=s.r/i+n,s.g=s.g/i+n,s.b=s.b/i+n,s},p.prototype.loadOverlay=function(t,e){var i,n,r=this;return(i=document.createElement("img")).onload=function(){return t.context.drawImage(i,0,0,r.c.dimensions.width,r.c.dimensions.height),t.imageData=t.context.getImageData(0,0,r.c.dimensions.width,r.c.dimensions.height),t.pixelData=t.imageData.data,r.c.pixelData=t.pixelData,r.processNext()},n=c.remoteCheck(e),i.src=null!=n?n:e},p}(),d=x.Renderer,x.Store=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var i=this;return setTimeout(function(){return e.call(i.get(t),i.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),m=x.Store,h.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),h.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),h.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),h.register("overlay",function(t,e){var i;return(i={}).r=128<e.r?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,i.g=128<e.g?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,i.b=128<e.b?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,i}),h.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),h.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),h.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),h.register("softLight",function(t,e){var i;return(i={}).r=128<e.r?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,i.g=128<e.g?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,i.b=128<e.b?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,i}),h.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),h.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),a.register("fillColor",function(){var e;return e=1===arguments.length?u.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(t){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=255,t})}),a.register("brightness",function(e){return e=Math.floor(e/100*255),this.process("brightness",function(t){return t.r+=e,t.g+=e,t.b+=e,t})}),a.register("saturation",function(i){return i*=-.01,this.process("saturation",function(t){var e;return e=Math.max(t.r,t.g,t.b),t.r!==e&&(t.r+=(e-t.r)*i),t.g!==e&&(t.g+=(e-t.g)*i),t.b!==e&&(t.b+=(e-t.b)*i),t})}),a.register("vibrance",function(r){return r*=-1,this.process("vibrance",function(t){var e,i,n;return n=Math.max(t.r,t.g,t.b),i=(t.r+t.g+t.b)/3,e=2*Math.abs(n-i)/255*r/100,t.r!==n&&(t.r+=(n-t.r)*e),t.g!==n&&(t.g+=(n-t.g)*e),t.b!==n&&(t.b+=(n-t.b)*e),t})}),a.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=p.luminance(t),t.r=e,t.g=e,t.b=e,t})}),a.register("contrast",function(e){return e=Math.pow((e+100)/100,2),this.process("contrast",function(t){return t.r/=255,t.r-=.5,t.r*=e,t.r+=.5,t.r*=255,t.g/=255,t.g-=.5,t.g*=e,t.g+=.5,t.g*=255,t.b/=255,t.b-=.5,t.b*=e,t.b+=.5,t.b*=255,t})}),a.register("hue",function(a){return this.process("hue",function(t){var e,i,n,r,s,o;return n=100*(r=u.rgbToHSV(t.r,t.g,t.b)).h,n+=Math.abs(a),n%=100,n/=100,r.h=n,s=(o=u.hsvToRGB(r.h,r.s,r.v)).r,i=o.g,e=o.b,t.r=s,t.g=i,t.b=e,t})}),a.register("colorize",function(){var e,i;return 2===arguments.length?(i=u.hexToRGB(arguments[0]),e=arguments[1]):4===arguments.length&&(i={r:arguments[0],g:arguments[1],b:arguments[2]},e=arguments[3]),this.process("colorize",function(t){return t.r-=(t.r-i.r)*(e/100),t.g-=(t.g-i.g)*(e/100),t.b-=(t.b-i.b)*(e/100),t})}),a.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),a.register("sepia",function(e){return null==e&&(e=100),e/=100,this.process("sepia",function(t){return t.r=Math.min(255,t.r*(1-.607*e)+t.g*(.769*e)+t.b*(.189*e)),t.g=Math.min(255,t.r*(.349*e)+t.g*(1-.314*e)+t.b*(.168*e)),t.b=Math.min(255,t.r*(.272*e)+t.g*(.534*e)+t.b*(1-.869*e)),t})}),a.register("gamma",function(e){return this.process("gamma",function(t){return t.r=255*Math.pow(t.r/255,e),t.g=255*Math.pow(t.g/255,e),t.b=255*Math.pow(t.b/255,e),t})}),a.register("noise",function(i){return i=2.55*Math.abs(i),this.process("noise",function(t){var e;return e=p.randomRange(-1*i,i),t.r+=e,t.g+=e,t.b+=e,t})}),a.register("clip",function(e){return e=2.55*Math.abs(e),this.process("clip",function(t){return t.r>255-e?t.r=255:t.r<e&&(t.r=0),t.g>255-e?t.g=255:t.g<e&&(t.g=0),t.b>255-e?t.b=255:t.b<e&&(t.b=0),t})}),a.register("channels",function(e){var t;if("object"!=typeof e)return this;for(t in e)F.call(e,t)&&(0!==e[t]?e[t]/=100:delete e[t]);return 0===e.length?this:this.process("channels",function(t){return null!=e.red&&(0<e.red?t.r+=(255-t.r)*e.red:t.r-=t.r*Math.abs(e.red)),null!=e.green&&(0<e.green?t.g+=(255-t.g)*e.green:t.g-=t.g*Math.abs(e.green)),null!=e.blue&&(0<e.blue?t.b+=(255-t.b)*e.blue:t.b-=t.b*Math.abs(e.blue)),t})}),a.register("curves",function(){var n,r,t,e,i,s,o,a,u,h,c,l;if(r=arguments[0],t=2<=arguments.length?C.call(arguments,1):[],"string"==typeof r&&(r=r.split("")),"v"===r[0]&&(r=["r","g","b"]),t.length<3||4<t.length)throw"Invalid number of arguments to curves filter";if(a=t[0],e=t[1],i=4===t.length?t[2]:t[1],s=t[t.length-1],n=p.bezier(a,e,i,s,0,255),0<a[0])for(o=u=0,c=a[0];0<=c?u<c:c<u;o=0<=c?++u:--u)n[o]=a[1];if(s[0]<255)for(o=h=l=s[0];l<=255?h<=255:255<=h;o=l<=255?++h:--h)n[o]=s[1];return this.process("curves",function(t){var e,i;for(o=e=0,i=r.length;0<=i?e<i:i<e;o=0<=i?++e:--e)t[r[o]]=n[t[r[o]]];return t})}),a.register("exposure",function(t){var e,i,n;return e=[0,255*(n=Math.abs(t)/100)],i=[255-255*n,255],t<0&&(e=e.reverse(),i=i.reverse()),this.curves("rgb",[0,0],e,i,[255,255])}),x.Plugin.register("crop",function(t,e,i,n){var r;return null==i&&(i=0),null==n&&(n=0),"undefined"!=typeof exports&&null!==exports?r=new f(t,e):(r=document.createElement("canvas"),M.copyAttributes(this.canvas,r),r.width=t,r.height=e),r.getContext("2d").drawImage(this.canvas,i,n,t,e,0,0,t,e),this.cropCoordinates={x:i,y:n},this.cropped=!0,this.replaceCanvas(r)}),x.Plugin.register("resize",function(t){var e;if(null==t&&(t=null),null!==t&&(null!=t.width||null!=t.height))return null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new f(t.width,t.height):(e=document.createElement("canvas"),M.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),e.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e);D.error("Invalid or missing dimensions given for resize")}),x.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),x.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),x.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),x.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),x.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),x.Filter.register("motionBlur",function(t){var e;return e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:0<t&&t<90||180<t&&t<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),x.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),b={brightness:function(t,e,i){return t.r=t.r-t.r*e*i.strength,t.g=t.g-t.g*e*i.strength,t.b=t.b-t.b*e*i.strength,t},gamma:function(t,e,i){return t.r=255*Math.pow(t.r/255,Math.max(10*e*i.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*i.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*i.strength,1)),t},colorize:function(t,e,i){return t.r-=(t.r-i.color.r)*e,t.g-=(t.g-i.color.g)*e,t.b-=(t.b-i.color.b)*e,t}},a.register("vignette",function(r,s){var o,a,u,t;return null==s&&(s=60),"string"==typeof r&&"%"===r.substr(-1)&&(r=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(r.substr(0,r.length-1),10)/100):this.dimensions.height*(parseInt(r.substr(0,r.length-1),10)/100)),s/=100,a=[this.dimensions.width/2,this.dimensions.height/2],t=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)),u=t-r,o=p.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(t){var e,i,n;return n=t.locationXY(),e=p.distance(n.x,n.y,a[0],a[1]),u<e&&(i=Math.max(1,o[Math.round((e-u)/r*100)]/10*s),t.r=255*Math.pow(t.r/255,i),t.g=255*Math.pow(t.g/255,i),t.b=255*Math.pow(t.b/255,i)),t})}),a.register("rectangularVignette",function(n){var t,e,i,r,s,o,a;if(t={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},!(n=M.extend(t,n)).size)return this;if("string"==typeof n.size)i=parseInt(n.size,10)/100,n.size={width:this.dimensions.width*i,height:this.dimensions.height*i};else if("object"==typeof n.size)for(s=0,o=(a=["width","height"]).length;s<o;s++)e=a[s],"string"==typeof n.size[e]&&(n.size[e]=this.dimensions[e]*(parseInt(n.size[e],10)/100));else"number"===n.size&&(r=n.size,n.size={width:r,height:r});return"string"==typeof n.cornerRadius&&(n.cornerRadius=n.size.width/2*(parseInt(n.cornerRadius,10)/100)),n.strength/=100,n.size.width=Math.floor(n.size.width),n.size.height=Math.floor(n.size.height),n.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===n.method&&"string"==typeof n.color&&(n.color=u.hexToRGB(n.color)),n.coords={left:(this.dimensions.width-n.size.width)/2,right:this.dimensions.width-n.coords.left,bottom:(this.dimensions.height-n.size.height)/2,top:this.dimensions.height-n.coords.bottom},n.corners=[{x:n.coords.left+n.cornerRadius,y:n.coords.top-n.cornerRadius},{x:n.coords.right-n.cornerRadius,y:n.coords.top-n.cornerRadius},{x:n.coords.right-n.cornerRadius,y:n.coords.bottom+n.cornerRadius},{x:n.coords.left+n.cornerRadius,y:n.coords.bottom+n.cornerRadius}],n.maxDist=p.distance(0,0,n.corners[3].x,n.corners[3].y)-n.cornerRadius,this.process("rectangularVignette",function(t){var e,i;return(i=t.locationXY()).x>n.corners[0].x&&i.x<n.corners[1].x&&i.y>n.coords.bottom&&i.y<n.coords.top?t:i.x>n.coords.left&&i.x<n.coords.right&&i.y>n.corners[3].y&&i.y<n.corners[2].y?t:(i.x>n.corners[0].x&&i.x<n.corners[1].x&&i.y>n.coords.top?e=(i.y-n.coords.top)/n.maxDist:i.y>n.corners[2].y&&i.y<n.corners[1].y&&i.x>n.coords.right?e=(i.x-n.coords.right)/n.maxDist:i.x>n.corners[0].x&&i.x<n.corners[1].x&&i.y<n.coords.bottom?e=(n.coords.bottom-i.y)/n.maxDist:i.y>n.corners[2].y&&i.y<n.corners[1].y&&i.x<n.coords.left?e=(n.coords.left-i.x)/n.maxDist:i.x<=n.corners[0].x&&i.y>=n.corners[0].y?e=(x.distance(i.x,i.y,n.corners[0].x,n.corners[0].y)-n.cornerRadius)/n.maxDist:i.x>=n.corners[1].x&&i.y>=n.corners[1].y?e=(x.distance(i.x,i.y,n.corners[1].x,n.corners[1].y)-n.cornerRadius)/n.maxDist:i.x>=n.corners[2].x&&i.y<=n.corners[2].y?e=(x.distance(i.x,i.y,n.corners[2].x,n.corners[2].y)-n.cornerRadius)/n.maxDist:i.x<=n.corners[3].x&&i.y<=n.corners[3].y&&(e=(x.distance(i.x,i.y,n.corners[3].x,n.corners[3].y)-n.cornerRadius)/n.maxDist),e<0?t:b[n.method](t,e,n))})}),ut=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],ht=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],S=function(t,e,i,n,r,s,o){var a,u,h,c,l,p,d;return(a="undefined"!=typeof exports&&null!==exports?new f:document.createElement("canvas")).width=t,a.height=e,c=i+Math.cos(r)*s*.5,p=n+Math.sin(r)*s*.5,l=i-Math.cos(r)*s*.5,d=n-Math.sin(r)*s*.5,h=(u=a.getContext("2d")).createLinearGradient(c,p,l,d),o?(h.addColorStop(0,"white"),h.addColorStop(.5,"black"),h.addColorStop(1,"white")):(h.addColorStop(0,"white"),h.addColorStop(1,"black")),u.fillStyle=h,u.fillRect(0,0,t,e),u.getImageData(0,0,t,e)},P=function(t,e,i,n,r,s){var o,a,u;return(o="undefined"!=typeof exports&&null!==exports?new f:document.createElement("canvas")).width=t,o.height=e,(u=(a=o.getContext("2d")).createRadialGradient(i,n,r,i,n,s)).addColorStop(1,"white"),u.addColorStop(0,"black"),a.fillStyle=u,a.fillRect(0,0,t,e),a.getImageData(0,0,t,e)},at=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},x.Plugin.register("compoundBlur",function(t,e,i,n){var r,s,o,a,u,h,c,l,p,d,f,g,m,y,v,b,x,w,D,R,M,S,P,I,C,F,L,k,B,_,A,z,E,T,j,O,N,J,G,q,H,$,W,U,K,V,X,Q,Y,Z,tt,et,it,nt,rt,st,ot;for(H=this.dimensions.width,d=this.dimensions.height,v=this.pixelData,k=t.data,q=(G=H*d)<<2,P=[],g=Q=0;0<=q?Q<q:q<Q;g=0<=q?++Q:--Q)P[g]=v[g];for(u=0,N=n,n-=1;0<=N--;)if(0!=(x=e+.5|0)){for(256<x&&(x=256),h=x+x+1,$=H-1,f=d-1,J=(B=x+1)*(B+1)/2,E=void 0,z=O=new at,g=Y=1;1<=h?Y<h:h<Y;g=1<=h?++Y:--Y)z=z.next=new at,g===B&&(E=z);for(z.next=O,j=T=null,X=K=0,D=ut[x],A=ht[x],U=Z=0;0<=d?Z<d:d<Z;U=0<=d?++Z:--Z){for(C=c=r=L=p=o=0,F=B*(I=P[K]),l=B*(S=P[K+1]),s=B*(M=P[K+2]),L+=J*I,p+=J*S,o+=J*M,z=O,g=tt=0;0<=B?tt<B:B<tt;g=0<=B?++tt:--tt)z.r=I,z.g=S,z.b=M,z=z.next;for(g=et=1;1<=B?et<B:B<et;g=1<=B?++et:--et)R=K+(($<g?$:g)<<2),L+=(z.r=I=P[R])*(_=B-g),p+=(z.g=S=P[R+1])*_,o+=(z.b=M=P[R+2])*_,C+=I,c+=S,r+=M,z=z.next;for(T=O,j=E,W=it=0;0<=H?it<H:H<it;W=0<=H?++it:--it)P[K]=L*D>>A,P[K+1]=p*D>>A,P[K+2]=o*D>>A,L-=F,p-=l,o-=s,F-=T.r,l-=T.g,s-=T.b,R=X+((R=W+B)<$?R:$)<<2,L+=C+=T.r=P[R],p+=c+=T.g=P[R+1],o+=r+=T.b=P[R+2],T=T.next,F+=I=j.r,l+=S=j.g,s+=M=j.b,C-=I,c-=S,r-=M,j=j.next,K+=4;X+=H}for(W=nt=0;0<=H?nt<H:H<nt;W=0<=H?++nt:--nt){for(c=r=C=p=o=L=0,F=B*(I=P[K=W<<2]),l=B*(S=P[K+1]),s=B*(M=P[K+2]),L+=J*I,p+=J*S,o+=J*M,z=O,g=rt=0;0<=B?rt<B:B<rt;g=0<=B?++rt:--rt)z.r=I,z.g=S,z.b=M,z=z.next;for(V=H,g=st=1;1<=B?st<B:B<st;g=1<=B?++st:--st)K=V+W<<2,L+=(z.r=I=P[K])*(_=B-g),p+=(z.g=S=P[K+1])*_,o+=(z.b=M=P[K+2])*_,C+=I,c+=S,r+=M,z=z.next,g<f&&(V+=H);for(K=W,T=O,j=E,U=ot=0;0<=d?ot<d:d<ot;U=0<=d?++ot:--ot)P[R=K<<2]=L*D>>A,P[R+1]=p*D>>A,P[R+2]=o*D>>A,L-=F,p-=l,o-=s,F-=T.r,l-=T.g,s-=T.b,R=W+((R=U+B)<f?R:f)*H<<2,L+=C+=T.r=P[R],p+=c+=T.g=P[R+1],o+=r+=T.b=P[R+2],T=T.next,F+=I=j.r,l+=S=j.g,s+=M=j.b,C-=I,c-=S,r-=M,j=j.next,K+=H}for(e*=i,g=G;-1<--g;)(b=0|(w=(255&k[2+(y=g<<2)])/255*n))===u?(m=256-(a=256*(w-(0|w))),v[y]=v[y]*m+P[y]*a>>8,v[y+1]=v[y+1]*m+P[y+1]*a>>8,v[y+2]=v[y+2]*m+P[y+2]*a>>8):b===u+1&&(v[y]=P[y],v[y+1]=P[y+1],v[y+2]=P[y+2]);u++}return this}),x.Filter.register("tiltShift",function(t){var e,i;return e={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},(t=M.extend(e,t)).angle*=Math.PI/180,i=S(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),x.Filter.register("radialBlur",function(t){var e,i,n,r;return e={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},(t=M.extend(e,t)).radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),n=t.radius/2-t.size,r=t.radius/2,i=P(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,n,r),this.processPlugin("compoundBlur",[i,t.startRadius,t.radiusFactor,t.steps])}),x.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),x.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),x.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),x.Filter.register("posterize",function(t){var e,i;return e=256/t,i=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*i),t.g=Math.floor(Math.floor(t.g/e)*i),t.b=Math.floor(Math.floor(t.b/e)*i),t})}),x.Filter.register("vintage",function(t){if(null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t)return this.vignette("40%",30)}),x.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),x.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),x.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),x.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),x.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),x.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),x.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),x.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),x.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),x.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),x.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),x.Filter.register("glowingSun",function(t){if(null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t)return this.vignette("45%",20)}),x.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),x.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),x.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),x.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),x.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),x.Plugin.register("rotate",function(t){var e,i,n,r,s,o,a,u;return 0===(e=t%360)?this.dimensions={width:this.canvas.width,height:this.canvas.height}:(s=Math.PI/180,"undefined"!=typeof exports&&null!==exports?i=new f:(i=document.createElement("canvas"),M.copyAttributes(this.canvas,i)),u=90===e||-270===e||270===e||-90===e?(a=(o=this.canvas.height)/2,(r=this.canvas.width)/2):180===e?(a=(o=this.canvas.width)/2,(r=this.canvas.height)/2):(r=o=Math.sqrt(Math.pow(this.originalWidth,2)+Math.pow(this.originalHeight,2)),a=this.canvas.height/2,this.canvas.width/2),i.width=o,i.height=r,(n=i.getContext("2d")).save(),n.translate(a,u),n.rotate(e*s),n.drawImage(this.canvas,-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height),n.restore(),this.replaceCanvas(i))}),x.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))}),W=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],U=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],$=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},x.Plugin.register("stackBlur",function(t){var e,i,n,r,s,o,a,u,h,c,l,p,d,f,g,m,y,v,b,x,w,D,R,M,S,P,I,C,F,L,k,B,_,A,z,E,T,j,O,N,J,G,q,H;if(!(isNaN(t)||t<1)){for(t|=0,g=this.pixelData,r=t+t+1,F=this.dimensions.width,L=F-1,h=(u=this.dimensions.height)-1,C=(x=t+1)*(x+1)/2,R=I=new $,c=E=1;1<=r?E<r:r<E;c=1<=r?++E:--E)R=R.next=new $,c===x&&(M=R);for(R.next=I,P=S=null,z=_=0,l=W[t],D=U[t],B=T=0;0<=u?T<u:u<T;B=0<=u?++T:--T){for(y=s=e=b=a=n=0,v=x*(m=g[_]),o=x*(f=g[_+1]),i=x*(d=g[_+2]),b+=C*m,a+=C*f,n+=C*d,R=I,c=j=0;0<=x?j<x:x<j;c=0<=x?++j:--j)R.r=m,R.g=f,R.b=d,R=R.next;for(c=O=1;1<=x?O<x:x<O;c=1<=x?++O:--O)p=_+((L<c?L:c)<<2),b+=(R.r=m=g[p])*(w=x-c),a+=(R.g=f=g[p+1])*w,n+=(R.b=d=g[p+2])*w,y+=m,s+=f,e+=d,R=R.next;for(S=I,P=M,k=N=0;0<=F?N<F:F<N;k=0<=F?++N:--N)g[_]=b*l>>D,g[_+1]=a*l>>D,g[_+2]=n*l>>D,b-=v,a-=o,n-=i,v-=S.r,o-=S.g,i-=S.b,p=z+((p=k+t+1)<L?p:L)<<2,b+=y+=S.r=g[p],a+=s+=S.g=g[p+1],n+=e+=S.b=g[p+2],S=S.next,v+=m=P.r,o+=f=P.g,i+=d=P.b,y-=m,s-=f,e-=d,P=P.next,_+=4;z+=F}for(k=J=0;0<=F?J<F:F<J;k=0<=F?++J:--J){for(s=e=y=a=n=b=0,v=x*(m=g[_=k<<2]),o=x*(f=g[_+1]),i=x*(d=g[_+2]),b+=C*m,a+=C*f,n+=C*d,R=I,c=G=0;0<=x?G<x:x<G;c=0<=x?++G:--G)R.r=m,R.g=f,R.b=d,R=R.next;for(A=F,c=q=1;1<=t?q<=t:t<=q;c=1<=t?++q:--q)_=A+k<<2,b+=(R.r=m=g[_])*(w=x-c),a+=(R.g=f=g[_+1])*w,n+=(R.b=d=g[_+2])*w,y+=m,s+=f,e+=d,R=R.next,c<h&&(A+=F);for(_=k,S=I,P=M,B=H=0;0<=u?H<u:u<H;B=0<=u?++H:--H)g[p=_<<2]=b*l>>D,g[p+1]=a*l>>D,g[p+2]=n*l>>D,b-=v,a-=o,n-=i,v-=S.r,o-=S.g,i-=S.b,p=k+((p=B+x)<h?p:h)*F<<2,b+=y+=S.r=g[p],a+=s+=S.g=g[p+1],n+=e+=S.b=g[p+2],S=S.next,v+=m=P.r,o+=f=P.g,i+=d=P.b,y-=m,s-=f,e-=d,P=P.next,_+=F}return this}}),x.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])}),x.Filter.register("threshold",function(i){return this.process("threshold",function(t){var e;return e=.2126*t.r+.7152*t.g+.0722*t.b,t.b=e<i?(t.r=0,t.g=0):(t.r=255,t.g=255),t})})}.call(this),function(){var i,n,r,s,o,a,u,t,h={}.hasOwnProperty;a=n=null,r=i=!(s={}),u=_.throttle(function(){var t,e;if(!i){for(t in i=!(r=!1),n.revert(!1),s)h.call(s,t)&&(e=s[t],0!==(e=parseFloat(e,10))&&n[t](e));return n.render(function(){if(i=!1,r)return u()})}r=!0},300),o=!1,t=function(t){var e,i;if(!o)return $("#PresetFilters a").removeClass("Active"),e=$("#PresetFilters a[data-preset='"+t+"']"),i=e.html(),e.addClass("Active").html('<button class="button">rendering</button>'),o=!0,a.revert(!1),a[t](),a.render(function(){return e.html(i),o=!1})},$(document).ready(function(){if(0<$("#sourceImage").length)return n=Caman("#sourceImage"),a=Caman("#sourceImage"),$(".FilterSetting input").each(function(){var t;return t=$(this).data("filter"),s[t]=$(this).val()}),$("#Filters").on("change",".FilterSetting input",function(){var t,e;return t=$(this).data("filter"),e=$(this).val(),s[t]=e,$(this).find("~ .FilterValue").html(e),u()}),$("#PresetFilters").on("click","a",function(){return t($(this).data("preset"))})})}.call(this),function(){var s;s=function(t){var e,i,n;return n=t.attr("id"),t.attr("id",""),i=$("<div>").css({position:"absolute",visibility:"hidden",top:$(document).scrollTop()+"px"}).attr("id",n).appendTo(document.body),document.location.hash="#"+n,i.remove(),t.attr("id",n),(e=$("#GuideSections li > a").filter("[href=#"+t.attr("id")+"]")).parents("ul").find(".Active").removeClass("Active"),e.parents("li").addClass("Active")},$(document).ready(function(){var r;return $("#GuideSections").on("click","a",function(){var t,e;return t=$($(this).attr("href")),e=Math.max(0,t.position().top-129),document.location.hash=$(this).attr("href"),setTimeout(function(){return $("body").scrollTop(e)},50),!1}),r=(r=_.map($("#GuideSections li > a"),function(t){return $($(t).attr("href"))})).reverse(),$(document).on("scroll",_.throttle(function(){var t,e,i,n;for(e=$(document).scrollTop(),i=0,n=r.length;i<n;i++)if(e>=(t=r[i]).position().top-130)return void s(t)},200))})}.call(this);